<% url = @youtube.url.gsub(/http.+v=/, "") %>
<% url = url.gsub(/&.+./, "") %>

<div class="embed-responsive embed-responsive-16by9">
  <%= sanitize '<iframe class="embed-responsive-item" src="https://www.youtube.com/embed/' + url + '?frameborder="0" allowfullscreen></iframe>',
    tags: %w(iframe),
    attributes: %w(class src allowfullscreen frameborder) %>
</div>

<div id="y_video_show_body">
  <div class="col-sm-9">
    <div id="y_video_show_titlearea">
      <h2><%= @youtube.title %></h2>

      <p>
        <strong>タグ:</strong>
        <% @youtube.youtube_video_tags.each do |tag| %>
          <%= link_to "##{tag.name}", { controller: :bits, action: :Search, search_params: tag.name } %>
        <% end -%>
      </p>

      <div id="video_show_button_area">
        <div id="share_button_area">
          <%# ツイートボタン %>
          <a href="https://twitter.com/share" class="twitter-share-button" data-text=<%= @youtube.title %> data-size="large">Tweet</a>
          <script src="//platform.twitter.com/widgets.js"></script>
          <%# フェイスブックシェア %>
          <% facebook_share_url = "https://www.facebook.com/plugins/share_button.php?href=http%3A%2F%2Fec2-13-112-39-20.ap-northeast-1.compute.amazonaws.com%2Fyoutube_videos%2F" + @youtube.id.to_s + "&layout=button&size=large&mobile_iframe=true&width=75&height=28&appId" %>
          <iframe src=<%= facebook_share_url.to_s %> width="75" height="28" style="border:none;overflow:hidden" scrolling="no" frameborder="0" allowTransparency="true"></iframe>
          <%# LINEシェアボタン %>
          <iframe data-lang="ja" data-type="share-c" data-url=<%= "http://ec2-13-112-39-20.ap-northeast-1.compute.amazonaws.com/youtube_videos/#{@youtube.id}" %> data-line-it-id="0" scrolling="no" frameborder="0" allowtransparency="true" class="line-it-button" src=<%= "https://timeline.line.me/lineit/share.it?url=http%3A%2F%2Fec2-13-112-39-20.ap-northeast-1.compute.amazonaws.com%2Fyoutube_videos%2F#{@youtube.id}&amp;buttonType=share-c&amp;lang=ja&amp;type=share&amp;id=0&amp;origin=http%3A%2F%2Flocalhost%3A3000%2Fyoutube_videos%2F#{@youtube.id}&amp;title=%E6%B1%9F%E6%88%B8%E6%99%82%E4%BB%A3%E3%81%AE%E5%BA%B6%E6%B0%91%E3%81%AE%E9%A3%9F%E4%BA%8B%E5%86%85%E5%AE%B9%E2%86%92%E7%B1%B3%E3%82%921%E6%97%A55%E5%90%88%E3%82%82%E9%A3%9F%E3%81%B9%E3%81%A6%E3%81%84%E3%81%9F%E4%BA%8B%E5%AE%9F" %> style="width: 84px; height: 20px; visibility: visible; position: static;"></iframe>
          <script src="https://d.line-scdn.net/r/web/social-plugin/js/thirdparty/loader.min.js" async="async" defer="defer"></script>
        </div>
        <div id="good_button_area">
          <%= render 'like', youtube: @youtube, likes: @likes %>
        </div>
      </div>
      <p id="y_video_show_pv_count">視聴回数<%= @youtube.pv_count %>回</p>
    </div>

    <div class="ad_area col-xs-12 hidden-sm hidden-md hidden-lg" style="text-align:center;padding-bottom:15px;">
      <!-- admax -->
      <div class="admax-native" data-admax-id="4b5879fb019fb93a43400dec4515824d"></div>
      <script type="text/javascript" charset="utf-8" src="//adm.shinobi.jp/st/na.js"></script>
      <!-- admax -->
    </div>
    <div class="ad_area hidden-xs col-sm-12 hidden-md hidden-lg" style="text-align:center;padding-bottom:15px;">
      <!-- admax -->
      <script src="//adm.shinobi.jp/s/b7c559839141ee4f6bbb301f9bda7e0d"></script>
      <!-- admax -->
    </div>
    <div class="ad_area hidden-xs hidden-sm col-md-12" style="text-align:center;padding-bottom:15px;">
      <!-- admax -->
      <script src="http://adm.shinobi.jp/s/de0a7cbba5f9ac2361cd2833ba7a1082"></script>
      <!-- admax -->
    </div>

    <div id="y_video_show_text">
      <%= simple_format(@youtube.text, class: :text) %>
    </div>

    <div id="y_video_commentsarea">
      <% unless current_user.nil? %>
        <div id="y_video_newcomment_edit_area">
          <%= form_for(@comment) do |f| %>
            <div class="form-group">
              <%= f.text_area :text,
                maxlength: "400",
                id: 'comment_text_area',
                onkeydown: 'if(event.keyCode == 13){javascript:transmission();}',
                onkeyup: "document.getElementById('y_video_commentsarea_characnt').value=400 - this.value.length",
                class: 'form-control' %>
            </div>
            <div id="comment_submit" class="actions　form-group">
              <input type="text" id="y_video_commentsarea_characnt" disabled="disabled">
              <%= f.submit 'コメント投稿', class: 'btn btn-primary' %>
            </div>
            <%= f.hidden_field :youtube_video_id, value: @youtube.id %>
          <% end %>
        </div>
      <% else %>
        <div id="y_video_newcomment_edit_area">
          <p>ログインするとコメントの投稿ができます。</p>
        </div>
      <% end %>

      <div id="y_video_comment_list_area">
        <div id="y_video_show_poster_comment_area">
          <strong>ビット運営</strong>
          <%= simple_format(@youtube.poster_comment, class: 'y_video_show_poster_comment_text') %>
        </div>
        <% unless @comments.nil? %>
          <% @comments.each do |comment| %>
            <% if comment.reply == 0 %>
              <div class="y_video_comment_list_view">
                <strong><%= comment.user.username %></strong>
                <%= comment.created_at.strftime('%Y年%m月%d日 %H時%M分%S秒') %><br>
                <p><%= simple_format(comment.text) %></p>

                <% @replys.each do |reply| %>
                  <% if reply.reply == comment.id %>
                    <div class="y_video_reply_list_view">
                      <strong><%= reply.user.username %></strong>
                      <%= reply.created_at.strftime('%Y年%m月%d日 %H時%M分%S秒') %><br>
                      <%= simple_format(reply.text) %>
                    </div>
                  <% end %>
                <% end %>

                <% unless current_user.nil? %>
                  <div id="y_video_reply_edit_area<%= comment.id %>" class="y_video_reply_edit_area" style="display: none;">
                    <%= form_tag('/comments/reply', method: :post) do %>
                      <div class="form-group">
                        <%= text_area_tag :text,
                          "",
                          maxlength: "400",
                          onkeydown: 'if(event.keyCode == 13){javascript:transmission();}',
                          onkeyup: "document.getElementById('y_video_replyarea_characnt').value=400 - this.value.length",
                          class: 'reply_text_area form-control' %>
                      </div>
                      <div id="reply_submit" class="actions　form-group">
                        <input type="text" id="y_video_replyarea_characnt" disabled="disabled">
                        <%= submit_tag '返信', class: 'btn btn-primary' %>
                      </div>
                      <%= hidden_field :reply_params, :youtube_video_id, value: @youtube.id%>
                      <%= hidden_field :reply_params, :comment_id, value: comment.id %>
                    <% end %>
                  </div>

                  <div class="reply_view_button_area">
                    <p id="reply_view_button<%= comment.id %>"
                      class="reply_view_button"
                      onClick="reply_display(<%= comment.id %>)">返信する
                    </p>
                  </div>
                <% end %>
              </div>
            <% end %>
          <% end %>
        <% end %>
      </div>
    </div>

    <% unless current_user.nil? %>
      <% if @youtube.user_id == current_user.id && current_user.user_level > 1 %>
        <%= link_to '編集する', edit_youtube_video_path(@youtube) %>
        <%= link_to '削除する', youtube_video_path(@youtube), method: :delete, data: { confirm: "削除してよろしいですか？" } %>
      <% end %>
    <% end %>
  </div>
</div>

<div id="related_videos_list" class="col-sm-3">
    <div class="co-xs-12" style="margin:0 0 15px 0;">
      <%= link_to image_tag('mu_ad_img1.jpg', width: '100%'), 'http://mu-ballet.com' %>
    </div>
  <p>関連動画</p>
  <% @relatedVideos.each do |rv| %>
    <div id="related_videos_link" class="row-eq-height">
      <% url = rv.url.gsub(/http.+v=/, "") %>
      <% url = url.gsub(/&.+./, "") %>
      <%= link_to(youtube_video_path(rv)) do %>
        <div id="related_videos_link_img" class="col-sm-6">
          <%= image_tag('http://i.ytimg.com/vi/' + url + '/hqdefault.jpg',
                                  width: '100%',
                                  class: 'bits_show_link_img') %>
        </div>
        <div id="related_videos_link_title" class="col-sm-6">
          <%= rv.title %>
        </div>
      <% end -%>
    </div>
  <% end %>
</div>

<script>
  function reply_display(comment_id) {
    var display = document.getElementById("y_video_reply_edit_area"+comment_id).style.display;

    if (display == 'none'){
      document.getElementById("y_video_reply_edit_area"+comment_id).style.display = 'block';
      document.getElementById("reply_view_button"+comment_id).innerHTML = 'キャンセル';
    }else {
      document.getElementById("y_video_reply_edit_area"+comment_id).style.display = 'none';
      document.getElementById("reply_view_button"+comment_id).innerHTML = '返信する';
    }
  }
</script>